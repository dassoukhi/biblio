f72cfa361f87885205d46505b9380a3b
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@angular/core/testing");
const http_1 = require("@angular/common/http");
const router_1 = require("@angular/router");
const rxjs_1 = require("rxjs");
const jest_date_mock_1 = require("jest-date-mock");
const test_module_1 = require("../../../test.module");
const audits_component_1 = require("app/admin/audits/audits.component");
const audits_service_1 = require("app/admin/audits/audits.service");
const audit_model_1 = require("app/admin/audits/audit.model");
const pagination_constants_1 = require("app/shared/constants/pagination.constants");
function build2DigitsDatePart(datePart) {
    return `0${datePart}`.slice(-2);
}
function getDate(isToday = true) {
    let date = new Date();
    if (isToday) {
        // Today + 1 day - needed if the current day must be included
        date.setDate(date.getDate() + 1);
    }
    else {
        // get last month
        if (date.getMonth() === 0) {
            date = new Date(date.getFullYear() - 1, 11, date.getDate());
        }
        else {
            date = new Date(date.getFullYear(), date.getMonth() - 1, date.getDate());
        }
    }
    const monthString = build2DigitsDatePart(date.getMonth() + 1);
    const dateString = build2DigitsDatePart(date.getDate());
    return `${date.getFullYear()}-${monthString}-${dateString}`;
}
describe('Component Tests', () => {
    describe('AuditsComponent', () => {
        let comp;
        let fixture;
        let service;
        let mockRouter;
        let mockActivatedRoute;
        beforeEach(testing_1.async(() => {
            testing_1.TestBed.configureTestingModule({
                imports: [test_module_1.BiblioTestModule],
                declarations: [audits_component_1.AuditsComponent],
                providers: [audits_service_1.AuditsService],
            })
                .overrideTemplate(audits_component_1.AuditsComponent, '')
                .compileComponents();
        }));
        beforeEach(() => {
            fixture = testing_1.TestBed.createComponent(audits_component_1.AuditsComponent);
            comp = fixture.componentInstance;
            service = fixture.debugElement.injector.get(audits_service_1.AuditsService);
            mockRouter = testing_1.TestBed.get(router_1.Router);
            mockActivatedRoute = testing_1.TestBed.get(router_1.ActivatedRoute);
        });
        describe('today function', () => {
            it('should set toDate to current date', () => {
                comp.ngOnInit();
                expect(comp.toDate).toBe(getDate());
            });
            it('if current day is last day of month then should set toDate to first day of next month', () => {
                jest_date_mock_1.advanceTo(new Date(2019, 0, 31, 0, 0, 0));
                comp.ngOnInit();
                expect(comp.toDate).toBe('2019-02-01');
            });
            it('if current day is not last day of month then should set toDate to next day of current month', () => {
                jest_date_mock_1.advanceTo(new Date(2019, 0, 27, 0, 0, 0));
                comp.ngOnInit();
                expect(comp.toDate).toBe('2019-01-28');
            });
        });
        describe('previousMonth function', () => {
            it('should set fromDate to previous month', () => {
                comp.ngOnInit();
                expect(comp.fromDate).toBe(getDate(false));
            });
            it('if current month is January then should set fromDate to previous year last month', () => {
                jest_date_mock_1.advanceTo(new Date(2019, 0, 20, 0, 0, 0));
                comp.ngOnInit();
                expect(comp.fromDate).toBe('2018-12-20');
            });
            it('if current month is not January then should set fromDate to current year previous month', () => {
                jest_date_mock_1.advanceTo(new Date(2019, 1, 20, 0, 0, 0));
                comp.ngOnInit();
                expect(comp.fromDate).toBe('2019-01-20');
            });
        });
        describe('By default, on init', () => {
            it('should set all default values correctly', () => {
                fixture.detectChanges();
                expect(comp.toDate).toBe(getDate());
                expect(comp.fromDate).toBe(getDate(false));
                expect(comp.itemsPerPage).toBe(pagination_constants_1.ITEMS_PER_PAGE);
                expect(comp.page).toBe(1);
                expect(comp.ascending).toBe(false);
                expect(comp.predicate).toBe('id');
            });
        });
        describe('OnInit', () => {
            it('Should call load all on init', () => {
                // GIVEN
                const headers = new http_1.HttpHeaders().append('X-Total-Count', '1');
                const audit = new audit_model_1.Audit({ remoteAddress: '127.0.0.1', sessionId: '123' }, 'user', '20140101', 'AUTHENTICATION_SUCCESS');
                spyOn(service, 'query').and.returnValue(rxjs_1.of(new http_1.HttpResponse({
                    body: [audit],
                    headers,
                })));
                // WHEN
                comp.ngOnInit();
                // THEN
                expect(service.query).toHaveBeenCalledTimes(1);
                expect(comp.audits && comp.audits[0]).toEqual(jasmine.objectContaining(audit));
                expect(comp.totalItems).toBe(1);
            });
        });
        describe('Create sort object', () => {
            beforeEach(() => {
                spyOn(service, 'query').and.returnValue(rxjs_1.of(new http_1.HttpResponse({ body: null })));
            });
            it('Should sort only by id asc', () => {
                // GIVEN
                mockActivatedRoute.setParameters({
                    sort: 'id,desc',
                });
                // WHEN
                comp.ngOnInit();
                // THEN
                expect(service.query).toBeCalledWith(expect.objectContaining({
                    sort: ['id,desc'],
                }));
            });
            it('Should sort by timestamp asc then by id', () => {
                // GIVEN
                mockActivatedRoute.setParameters({
                    sort: 'timestamp,asc',
                });
                // WHEN
                comp.ngOnInit();
                // THEN
                expect(service.query).toBeCalledWith(expect.objectContaining({
                    sort: ['timestamp,asc', 'id'],
                }));
            });
        });
        describe('transition', () => {
            it('Should not query data if fromDate and toDate are empty', () => {
                // GIVEN
                comp.toDate = '';
                comp.fromDate = '';
                // WHEN
                comp.transition();
                // THEN
                expect(comp.canLoad()).toBe(false);
                expect(mockRouter.navigateSpy).not.toBeCalled();
            });
            it('Should query data if fromDate and toDate are not empty', () => {
                // GIVEN
                comp.toDate = getDate();
                comp.fromDate = getDate(false);
                // WHEN
                comp.transition();
                // THEN
                expect(comp.canLoad()).toBe(true);
                expect(mockRouter.navigateSpy).toBeCalled();
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxEYXNzXFxEZXNrdG9wXFxNYXN0ZXIxX1lOT1ZcXERldkxvZ2ljaWVsXFxiaWJsaW9cXHNyY1xcdGVzdFxcamF2YXNjcmlwdFxcc3BlY1xcYXBwXFxhZG1pblxcYXVkaXRzXFxhdWRpdHMuY29tcG9uZW50LnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSxtREFBeUU7QUFDekUsK0NBQWlFO0FBQ2pFLDRDQUF5RDtBQUN6RCwrQkFBMEI7QUFDMUIsbURBQTJDO0FBRTNDLHNEQUF3RDtBQUN4RCx3RUFBb0U7QUFDcEUsb0VBQWdFO0FBQ2hFLDhEQUFxRDtBQUNyRCxvRkFBMkU7QUFHM0UsU0FBUyxvQkFBb0IsQ0FBQyxRQUFnQjtJQUM1QyxPQUFPLElBQUksUUFBUSxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDbEMsQ0FBQztBQUVELFNBQVMsT0FBTyxDQUFDLE9BQU8sR0FBRyxJQUFJO0lBQzdCLElBQUksSUFBSSxHQUFTLElBQUksSUFBSSxFQUFFLENBQUM7SUFDNUIsSUFBSSxPQUFPLEVBQUU7UUFDWCw2REFBNkQ7UUFDN0QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7S0FDbEM7U0FBTTtRQUNMLGlCQUFpQjtRQUNqQixJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLEVBQUU7WUFDekIsSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1NBQzdEO2FBQU07WUFDTCxJQUFJLEdBQUcsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxFQUFFLElBQUksQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLEVBQUUsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7U0FDMUU7S0FDRjtJQUNELE1BQU0sV0FBVyxHQUFH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QztZQUM5QyxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXERhc3NcXERlc2t0b3BcXE1hc3RlcjFfWU5PVlxcRGV2TG9naWNpZWxcXGJpYmxpb1xcc3JjXFx0ZXN0XFxqYXZhc2NyaXB0XFxzcGVjXFxhcHBcXGFkbWluXFxhdWRpdHNcXGF1ZGl0cy5jb21wb25lbnQuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnRGaXh0dXJlLCBUZXN0QmVkLCBhc3luYyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUvdGVzdGluZyc7XHJcbmltcG9ydCB7IEh0dHBIZWFkZXJzLCBIdHRwUmVzcG9uc2UgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XHJcbmltcG9ydCB7IFJvdXRlciwgQWN0aXZhdGVkUm91dGUgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xyXG5pbXBvcnQgeyBvZiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBhZHZhbmNlVG8gfSBmcm9tICdqZXN0LWRhdGUtbW9jayc7XHJcblxyXG5pbXBvcnQgeyBCaWJsaW9UZXN0TW9kdWxlIH0gZnJvbSAnLi4vLi4vLi4vdGVzdC5tb2R1bGUnO1xyXG5pbXBvcnQgeyBBdWRpdHNDb21wb25lbnQgfSBmcm9tICdhcHAvYWRtaW4vYXVkaXRzL2F1ZGl0cy5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBBdWRpdHNTZXJ2aWNlIH0gZnJvbSAnYXBwL2FkbWluL2F1ZGl0cy9hdWRpdHMuc2VydmljZSc7XHJcbmltcG9ydCB7IEF1ZGl0IH0gZnJvbSAnYXBwL2FkbWluL2F1ZGl0cy9hdWRpdC5tb2RlbCc7XHJcbmltcG9ydCB7IElURU1TX1BFUl9QQUdFIH0gZnJvbSAnYXBwL3NoYXJlZC9jb25zdGFudHMvcGFnaW5hdGlvbi5jb25zdGFudHMnO1xyXG5pbXBvcnQgeyBNb2NrUm91dGVyLCBNb2NrQWN0aXZhdGVkUm91dGUgfSBmcm9tICcuLi8uLi8uLi9oZWxwZXJzL21vY2stcm91dGUuc2VydmljZSc7XHJcblxyXG5mdW5jdGlvbiBidWlsZDJEaWdpdHNEYXRlUGFydChkYXRlUGFydDogbnVtYmVyKTogc3RyaW5nIHtcclxuICByZXR1cm4gYDAke2RhdGVQYXJ0fWAuc2xpY2UoLTIpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXREYXRlKGlzVG9kYXkgPSB0cnVlKTogc3RyaW5nIHtcclxuICBsZXQgZGF0ZTogRGF0ZSA9IG5ldyBEYXRlKCk7XHJcbiAgaWYgKGlzVG9kYXkpIHtcclxuICAgIC8vIFRvZGF5ICsgMSBkYXkgLSBuZWVkZWQgaWYgdGhlIGN1cnJlbnQgZGF5IG11c3QgYmUgaW5jbHVkZWRcclxuICAgIGRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSArIDEpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICAvLyBnZXQgbGFzdCBtb250aFxyXG4gICAgaWYgKGRhdGUuZ2V0TW9udGgoKSA9PT0gMCkge1xyXG4gICAgICBkYXRlID0gbmV3IERhdGUoZGF0ZS5nZXRGdWxsWWVhcigpIC0gMSwgMTEsIGRhdGUuZ2V0RGF0ZSgpKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGRhdGUgPSBuZXcgRGF0ZShkYXRlLmdldEZ1bGxZZWFyKCksIGRhdGUuZ2V0TW9udGgoKSAtIDEsIGRhdGUuZ2V0RGF0ZSgpKTtcclxuICAgIH1cclxuICB9XHJcbiAgY29uc3QgbW9udGhTdHJpbmcgPSBidWlsZDJEaWdpdHNEYXRlUGFydChkYXRlLmdldE1vbnRoKCkgKyAxKTtcclxuICBjb25zdCBkYXRlU3RyaW5nID0gYnVpbGQyRGlnaXRzRGF0ZVBhcnQoZGF0ZS5nZXREYXRlKCkpO1xyXG4gIHJldHVybiBgJHtkYXRlLmdldEZ1bGxZZWFyKCl9LSR7bW9udGhTdHJpbmd9LSR7ZGF0ZVN0cmluZ31gO1xyXG59XHJcblxyXG5kZXNjcmliZSgnQ29tcG9uZW50IFRlc3RzJywgKCkgPT4ge1xyXG4gIGRlc2NyaWJlKCdBdWRpdHNDb21wb25lbnQnLCAoKSA9PiB7XHJcbiAgICBsZXQgY29tcDogQXVkaXRzQ29tcG9uZW50O1xyXG4gICAgbGV0IGZpeHR1cmU6IENvbXBvbmVudEZpeHR1cmU8QXVkaXRzQ29tcG9uZW50PjtcclxuICAgIGxldCBzZXJ2aWNlOiBBdWRpdHNTZXJ2aWNlO1xyXG4gICAgbGV0IG1vY2tSb3V0ZXI6IE1vY2tSb3V0ZXI7XHJcbiAgICBsZXQgbW9ja0FjdGl2YXRlZFJvdXRlOiBNb2NrQWN0aXZhdGVkUm91dGU7XHJcblxyXG4gICAgYmVmb3JlRWFjaChhc3luYygoKSA9PiB7XHJcbiAgICAgIFRlc3RCZWQuY29uZmlndXJlVGVzdGluZ01vZHVsZSh7XHJcbiAgICAgICAgaW1wb3J0czogW0JpYmxpb1Rlc3RNb2R1bGVdLFxyXG4gICAgICAgIGRlY2xhcmF0aW9uczogW0F1ZGl0c0NvbXBvbmVudF0sXHJcbiAgICAgICAgcHJvdmlkZXJzOiBbQXVkaXRzU2VydmljZV0sXHJcbiAgICAgIH0pXHJcbiAgICAgICAgLm92ZXJyaWRlVGVtcGxhdGUoQXVkaXRzQ29tcG9uZW50LCAnJylcclxuICAgICAgICAuY29tcGlsZUNvbXBvbmVudHMoKTtcclxuICAgIH0pKTtcclxuXHJcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgZml4dHVyZSA9IFRlc3RCZWQuY3JlYXRlQ29tcG9uZW50KEF1ZGl0c0NvbXBvbmVudCk7XHJcbiAgICAgIGNvbXAgPSBmaXh0dXJlLmNvbXBvbmVudEluc3RhbmNlO1xyXG4gICAgICBzZXJ2aWNlID0gZml4dHVyZS5kZWJ1Z0VsZW1lbnQuaW5qZWN0b3IuZ2V0KEF1ZGl0c1NlcnZpY2UpO1xyXG4gICAgICBtb2NrUm91dGVyID0gVGVzdEJlZC5nZXQoUm91dGVyKTtcclxuICAgICAgbW9ja0FjdGl2YXRlZFJvdXRlID0gVGVzdEJlZC5nZXQoQWN0aXZhdGVkUm91dGUpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ3RvZGF5IGZ1bmN0aW9uJywgKCkgPT4ge1xyXG4gICAgICBpdCgnc2hvdWxkIHNldCB0b0RhdGUgdG8gY3VycmVudCBkYXRlJywgKCkgPT4ge1xyXG4gICAgICAgIGNvbXAubmdPbkluaXQoKTtcclxuICAgICAgICBleHBlY3QoY29tcC50b0RhdGUpLnRvQmUoZ2V0RGF0ZSgpKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpdCgnaWYgY3VycmVudCBkYXkgaXMgbGFzdCBkYXkgb2YgbW9udGggdGhlbiBzaG91bGQgc2V0IHRvRGF0ZSB0byBmaXJzdCBkYXkgb2YgbmV4dCBtb250aCcsICgpID0+IHtcclxuICAgICAgICBhZHZhbmNlVG8obmV3IERhdGUoMjAxOSwgMCwgMzEsIDAsIDAsIDApKTtcclxuICAgICAgICBjb21wLm5nT25Jbml0KCk7XHJcbiAgICAgICAgZXhwZWN0KGNvbXAudG9EYXRlKS50b0JlKCcyMDE5LTAyLTAxJyk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaXQoJ2lmIGN1cnJlbnQgZGF5IGlzIG5vdCBsYXN0IGRheSBvZiBtb250aCB0aGVuIHNob3VsZCBzZXQgdG9EYXRlIHRvIG5leHQgZGF5IG9mIGN1cnJlbnQgbW9udGgnLCAoKSA9PiB7XHJcbiAgICAgICAgYWR2YW5jZVRvKG5ldyBEYXRlKDIwMTksIDAsIDI3LCAwLCAwLCAwKSk7XHJcbiAgICAgICAgY29tcC5uZ09uSW5pdCgpO1xyXG4gICAgICAgIGV4cGVjdChjb21wLnRvRGF0ZSkudG9CZSgnMjAxOS0wMS0yOCcpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdwcmV2aW91c01vbnRoIGZ1bmN0aW9uJywgKCkgPT4ge1xyXG4gICAgICBpdCgnc2hvdWxkIHNldCBmcm9tRGF0ZSB0byBwcmV2aW91cyBtb250aCcsICgpID0+IHtcclxuICAgICAgICBjb21wLm5nT25Jbml0KCk7XHJcbiAgICAgICAgZXhwZWN0KGNvbXAuZnJvbURhdGUpLnRvQmUoZ2V0RGF0ZShmYWxzZSkpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGl0KCdpZiBjdXJyZW50IG1vbnRoIGlzIEphbnVhcnkgdGhlbiBzaG91bGQgc2V0IGZyb21EYXRlIHRvIHByZXZpb3VzIHllYXIgbGFzdCBtb250aCcsICgpID0+IHtcclxuICAgICAgICBhZHZhbmNlVG8obmV3IERhdGUoMjAxOSwgMCwgMjAsIDAsIDAsIDApKTtcclxuICAgICAgICBjb21wLm5nT25Jbml0KCk7XHJcbiAgICAgICAgZXhwZWN0KGNvbXAuZnJvbURhdGUpLnRvQmUoJzIwMTgtMTItMjAnKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpdCgnaWYgY3VycmVudCBtb250aCBpcyBub3QgSmFudWFyeSB0aGVuIHNob3VsZCBzZXQgZnJvbURhdGUgdG8gY3VycmVudCB5ZWFyIHByZXZpb3VzIG1vbnRoJywgKCkgPT4ge1xyXG4gICAgICAgIGFkdmFuY2VUbyhuZXcgRGF0ZSgyMDE5LCAxLCAyMCwgMCwgMCwgMCkpO1xyXG4gICAgICAgIGNvbXAubmdPbkluaXQoKTtcclxuICAgICAgICBleHBlY3QoY29tcC5mcm9tRGF0ZSkudG9CZSgnMjAxOS0wMS0yMCcpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdCeSBkZWZhdWx0LCBvbiBpbml0JywgKCkgPT4ge1xyXG4gICAgICBpdCgnc2hvdWxkIHNldCBhbGwgZGVmYXVsdCB2YWx1ZXMgY29ycmVjdGx5JywgKCkgPT4ge1xyXG4gICAgICAgIGZpeHR1cmUuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gICAgICAgIGV4cGVjdChjb21wLnRvRGF0ZSkudG9CZShnZXREYXRlKCkpO1xyXG4gICAgICAgIGV4cGVjdChjb21wLmZyb21EYXRlKS50b0JlKGdldERhdGUoZmFsc2UpKTtcclxuICAgICAgICBleHBlY3QoY29tcC5pdGVtc1BlclBhZ2UpLnRvQmUoSVRFTVNfUEVSX1BBR0UpO1xyXG4gICAgICAgIGV4cGVjdChjb21wLnBhZ2UpLnRvQmUoMSk7XHJcbiAgICAgICAgZXhwZWN0KGNvbXAuYXNjZW5kaW5nKS50b0JlKGZhbHNlKTtcclxuICAgICAgICBleHBlY3QoY29tcC5wcmVkaWNhdGUpLnRvQmUoJ2lkJyk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ09uSW5pdCcsICgpID0+IHtcclxuICAgICAgaXQoJ1Nob3VsZCBjYWxsIGxvYWQgYWxsIG9uIGluaXQnLCAoKSA9PiB7XHJcbiAgICAgICAgLy8gR0lWRU5cclxuICAgICAgICBjb25zdCBoZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKCkuYXBwZW5kKCdYLVRvdGFsLUNvdW50JywgJzEnKTtcclxuICAgICAgICBjb25zdCBhdWRpdCA9IG5ldyBBdWRpdCh7IHJlbW90ZUFkZHJlc3M6ICcxMjcuMC4wLjEnLCBzZXNzaW9uSWQ6ICcxMjMnIH0sICd1c2VyJywgJzIwMTQwMTAxJywgJ0FVVEhFTlRJQ0FUSU9OX1NVQ0NFU1MnKTtcclxuICAgICAgICBzcHlPbihzZXJ2aWNlLCAncXVlcnknKS5hbmQucmV0dXJuVmFsdWUoXHJcbiAgICAgICAgICBvZihcclxuICAgICAgICAgICAgbmV3IEh0dHBSZXNwb25zZSh7XHJcbiAgICAgICAgICAgICAgYm9keTogW2F1ZGl0XSxcclxuICAgICAgICAgICAgICBoZWFkZXJzLFxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgKVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIC8vIFdIRU5cclxuICAgICAgICBjb21wLm5nT25Jbml0KCk7XHJcblxyXG4gICAgICAgIC8vIFRIRU5cclxuICAgICAgICBleHBlY3Qoc2VydmljZS5xdWVyeSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xyXG4gICAgICAgIGV4cGVjdChjb21wLmF1ZGl0cyAmJiBjb21wLmF1ZGl0c1swXSkudG9FcXVhbChqYXNtaW5lLm9iamVjdENvbnRhaW5pbmcoYXVkaXQpKTtcclxuICAgICAgICBleHBlY3QoY29tcC50b3RhbEl0ZW1zKS50b0JlKDEpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdDcmVhdGUgc29ydCBvYmplY3QnLCAoKSA9PiB7XHJcbiAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICAgIHNweU9uKHNlcnZpY2UsICdxdWVyeScpLmFuZC5yZXR1cm5WYWx1ZShvZihuZXcgSHR0cFJlc3BvbnNlKHsgYm9keTogbnVsbCB9KSkpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGl0KCdTaG91bGQgc29ydCBvbmx5IGJ5IGlkIGFzYycsICgpID0+IHtcclxuICAgICAgICAvLyBHSVZFTlxyXG4gICAgICAgIG1vY2tBY3RpdmF0ZWRSb3V0ZS5zZXRQYXJhbWV0ZXJzKHtcclxuICAgICAgICAgIHNvcnQ6ICdpZCxkZXNjJyxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gV0hFTlxyXG4gICAgICAgIGNvbXAubmdPbkluaXQoKTtcclxuXHJcbiAgICAgICAgLy8gVEhFTlxyXG4gICAgICAgIGV4cGVjdChzZXJ2aWNlLnF1ZXJ5KS50b0JlQ2FsbGVkV2l0aChcclxuICAgICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICAgICAgc29ydDogWydpZCxkZXNjJ10sXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaXQoJ1Nob3VsZCBzb3J0IGJ5IHRpbWVzdGFtcCBhc2MgdGhlbiBieSBpZCcsICgpID0+IHtcclxuICAgICAgICAvLyBHSVZFTlxyXG4gICAgICAgIG1vY2tBY3RpdmF0ZWRSb3V0ZS5zZXRQYXJhbWV0ZXJzKHtcclxuICAgICAgICAgIHNvcnQ6ICd0aW1lc3RhbXAsYXNjJyxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gV0hFTlxyXG4gICAgICAgIGNvbXAubmdPbkluaXQoKTtcclxuXHJcbiAgICAgICAgLy8gVEhFTlxyXG4gICAgICAgIGV4cGVjdChzZXJ2aWNlLnF1ZXJ5KS50b0JlQ2FsbGVkV2l0aChcclxuICAgICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICAgICAgc29ydDogWyd0aW1lc3RhbXAsYXNjJywgJ2lkJ10sXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ3RyYW5zaXRpb24nLCAoKSA9PiB7XHJcbiAgICAgIGl0KCdTaG91bGQgbm90IHF1ZXJ5IGRhdGEgaWYgZnJvbURhdGUgYW5kIHRvRGF0ZSBhcmUgZW1wdHknLCAoKSA9PiB7XHJcbiAgICAgICAgLy8gR0lWRU5cclxuICAgICAgICBjb21wLnRvRGF0ZSA9ICcnO1xyXG4gICAgICAgIGNvbXAuZnJvbURhdGUgPSAnJztcclxuXHJcbiAgICAgICAgLy8gV0hFTlxyXG4gICAgICAgIGNvbXAudHJhbnNpdGlvbigpO1xyXG5cclxuICAgICAgICAvLyBUSEVOXHJcbiAgICAgICAgZXhwZWN0KGNvbXAuY2FuTG9hZCgpKS50b0JlKGZhbHNlKTtcclxuICAgICAgICBleHBlY3QobW9ja1JvdXRlci5uYXZpZ2F0ZVNweSkubm90LnRvQmVDYWxsZWQoKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpdCgnU2hvdWxkIHF1ZXJ5IGRhdGEgaWYgZnJvbURhdGUgYW5kIHRvRGF0ZSBhcmUgbm90IGVtcHR5JywgKCkgPT4ge1xyXG4gICAgICAgIC8vIEdJVkVOXHJcbiAgICAgICAgY29tcC50b0RhdGUgPSBnZXREYXRlKCk7XHJcbiAgICAgICAgY29tcC5mcm9tRGF0ZSA9IGdldERhdGUoZmFsc2UpO1xyXG5cclxuICAgICAgICAvLyBXSEVOXHJcbiAgICAgICAgY29tcC50cmFuc2l0aW9uKCk7XHJcblxyXG4gICAgICAgIC8vIFRIRU5cclxuICAgICAgICBleHBlY3QoY29tcC5jYW5Mb2FkKCkpLnRvQmUodHJ1ZSk7XHJcbiAgICAgICAgZXhwZWN0KG1vY2tSb3V0ZXIubmF2aWdhdGVTcHkpLnRvQmVDYWxsZWQoKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7XHJcbiJdLCJ2ZXJzaW9uIjozfQ==