{"file":"C:\\Users\\Dass\\Desktop\\Master1_YNOV\\DevLogiciel\\biblio\\src\\test\\javascript\\spec\\app\\admin\\audits\\audits.component.spec.ts","mappings":"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","names":[],"sources":["C:\\Users\\Dass\\Desktop\\Master1_YNOV\\DevLogiciel\\biblio\\src\\test\\javascript\\spec\\app\\admin\\audits\\audits.component.spec.ts"],"sourcesContent":["import { ComponentFixture, TestBed, async } from '@angular/core/testing';\r\nimport { HttpHeaders, HttpResponse } from '@angular/common/http';\r\nimport { Router, ActivatedRoute } from '@angular/router';\r\nimport { of } from 'rxjs';\r\nimport { advanceTo } from 'jest-date-mock';\r\n\r\nimport { BiblioTestModule } from '../../../test.module';\r\nimport { AuditsComponent } from 'app/admin/audits/audits.component';\r\nimport { AuditsService } from 'app/admin/audits/audits.service';\r\nimport { Audit } from 'app/admin/audits/audit.model';\r\nimport { ITEMS_PER_PAGE } from 'app/shared/constants/pagination.constants';\r\nimport { MockRouter, MockActivatedRoute } from '../../../helpers/mock-route.service';\r\n\r\nfunction build2DigitsDatePart(datePart: number): string {\r\n  return `0${datePart}`.slice(-2);\r\n}\r\n\r\nfunction getDate(isToday = true): string {\r\n  let date: Date = new Date();\r\n  if (isToday) {\r\n    // Today + 1 day - needed if the current day must be included\r\n    date.setDate(date.getDate() + 1);\r\n  } else {\r\n    // get last month\r\n    if (date.getMonth() === 0) {\r\n      date = new Date(date.getFullYear() - 1, 11, date.getDate());\r\n    } else {\r\n      date = new Date(date.getFullYear(), date.getMonth() - 1, date.getDate());\r\n    }\r\n  }\r\n  const monthString = build2DigitsDatePart(date.getMonth() + 1);\r\n  const dateString = build2DigitsDatePart(date.getDate());\r\n  return `${date.getFullYear()}-${monthString}-${dateString}`;\r\n}\r\n\r\ndescribe('Component Tests', () => {\r\n  describe('AuditsComponent', () => {\r\n    let comp: AuditsComponent;\r\n    let fixture: ComponentFixture<AuditsComponent>;\r\n    let service: AuditsService;\r\n    let mockRouter: MockRouter;\r\n    let mockActivatedRoute: MockActivatedRoute;\r\n\r\n    beforeEach(async(() => {\r\n      TestBed.configureTestingModule({\r\n        imports: [BiblioTestModule],\r\n        declarations: [AuditsComponent],\r\n        providers: [AuditsService],\r\n      })\r\n        .overrideTemplate(AuditsComponent, '')\r\n        .compileComponents();\r\n    }));\r\n\r\n    beforeEach(() => {\r\n      fixture = TestBed.createComponent(AuditsComponent);\r\n      comp = fixture.componentInstance;\r\n      service = fixture.debugElement.injector.get(AuditsService);\r\n      mockRouter = TestBed.get(Router);\r\n      mockActivatedRoute = TestBed.get(ActivatedRoute);\r\n    });\r\n\r\n    describe('today function', () => {\r\n      it('should set toDate to current date', () => {\r\n        comp.ngOnInit();\r\n        expect(comp.toDate).toBe(getDate());\r\n      });\r\n\r\n      it('if current day is last day of month then should set toDate to first day of next month', () => {\r\n        advanceTo(new Date(2019, 0, 31, 0, 0, 0));\r\n        comp.ngOnInit();\r\n        expect(comp.toDate).toBe('2019-02-01');\r\n      });\r\n\r\n      it('if current day is not last day of month then should set toDate to next day of current month', () => {\r\n        advanceTo(new Date(2019, 0, 27, 0, 0, 0));\r\n        comp.ngOnInit();\r\n        expect(comp.toDate).toBe('2019-01-28');\r\n      });\r\n    });\r\n\r\n    describe('previousMonth function', () => {\r\n      it('should set fromDate to previous month', () => {\r\n        comp.ngOnInit();\r\n        expect(comp.fromDate).toBe(getDate(false));\r\n      });\r\n\r\n      it('if current month is January then should set fromDate to previous year last month', () => {\r\n        advanceTo(new Date(2019, 0, 20, 0, 0, 0));\r\n        comp.ngOnInit();\r\n        expect(comp.fromDate).toBe('2018-12-20');\r\n      });\r\n\r\n      it('if current month is not January then should set fromDate to current year previous month', () => {\r\n        advanceTo(new Date(2019, 1, 20, 0, 0, 0));\r\n        comp.ngOnInit();\r\n        expect(comp.fromDate).toBe('2019-01-20');\r\n      });\r\n    });\r\n\r\n    describe('By default, on init', () => {\r\n      it('should set all default values correctly', () => {\r\n        fixture.detectChanges();\r\n        expect(comp.toDate).toBe(getDate());\r\n        expect(comp.fromDate).toBe(getDate(false));\r\n        expect(comp.itemsPerPage).toBe(ITEMS_PER_PAGE);\r\n        expect(comp.page).toBe(1);\r\n        expect(comp.ascending).toBe(false);\r\n        expect(comp.predicate).toBe('id');\r\n      });\r\n    });\r\n\r\n    describe('OnInit', () => {\r\n      it('Should call load all on init', () => {\r\n        // GIVEN\r\n        const headers = new HttpHeaders().append('X-Total-Count', '1');\r\n        const audit = new Audit({ remoteAddress: '127.0.0.1', sessionId: '123' }, 'user', '20140101', 'AUTHENTICATION_SUCCESS');\r\n        spyOn(service, 'query').and.returnValue(\r\n          of(\r\n            new HttpResponse({\r\n              body: [audit],\r\n              headers,\r\n            })\r\n          )\r\n        );\r\n\r\n        // WHEN\r\n        comp.ngOnInit();\r\n\r\n        // THEN\r\n        expect(service.query).toHaveBeenCalledTimes(1);\r\n        expect(comp.audits && comp.audits[0]).toEqual(jasmine.objectContaining(audit));\r\n        expect(comp.totalItems).toBe(1);\r\n      });\r\n    });\r\n\r\n    describe('Create sort object', () => {\r\n      beforeEach(() => {\r\n        spyOn(service, 'query').and.returnValue(of(new HttpResponse({ body: null })));\r\n      });\r\n\r\n      it('Should sort only by id asc', () => {\r\n        // GIVEN\r\n        mockActivatedRoute.setParameters({\r\n          sort: 'id,desc',\r\n        });\r\n\r\n        // WHEN\r\n        comp.ngOnInit();\r\n\r\n        // THEN\r\n        expect(service.query).toBeCalledWith(\r\n          expect.objectContaining({\r\n            sort: ['id,desc'],\r\n          })\r\n        );\r\n      });\r\n\r\n      it('Should sort by timestamp asc then by id', () => {\r\n        // GIVEN\r\n        mockActivatedRoute.setParameters({\r\n          sort: 'timestamp,asc',\r\n        });\r\n\r\n        // WHEN\r\n        comp.ngOnInit();\r\n\r\n        // THEN\r\n        expect(service.query).toBeCalledWith(\r\n          expect.objectContaining({\r\n            sort: ['timestamp,asc', 'id'],\r\n          })\r\n        );\r\n      });\r\n    });\r\n\r\n    describe('transition', () => {\r\n      it('Should not query data if fromDate and toDate are empty', () => {\r\n        // GIVEN\r\n        comp.toDate = '';\r\n        comp.fromDate = '';\r\n\r\n        // WHEN\r\n        comp.transition();\r\n\r\n        // THEN\r\n        expect(comp.canLoad()).toBe(false);\r\n        expect(mockRouter.navigateSpy).not.toBeCalled();\r\n      });\r\n\r\n      it('Should query data if fromDate and toDate are not empty', () => {\r\n        // GIVEN\r\n        comp.toDate = getDate();\r\n        comp.fromDate = getDate(false);\r\n\r\n        // WHEN\r\n        comp.transition();\r\n\r\n        // THEN\r\n        expect(comp.canLoad()).toBe(true);\r\n        expect(mockRouter.navigateSpy).toBeCalled();\r\n      });\r\n    });\r\n  });\r\n});\r\n"],"version":3}